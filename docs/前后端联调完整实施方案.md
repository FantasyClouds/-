# 前后端联调完整实施方案

## 📋 项目概述

### 技术栈信息

- **后端**: Spring Boot 3.x + MySQL + MyBatis-Plus
- **前端**: Vue 3 + Vite + Axios + Pinia
- **后端端口**: 8080
- **前端端口**: 5173
- **数据库**: MySQL 8.0

### 项目结构

```
项目根目录/
├── swxz/                    # 后端项目
│   ├── src/main/java/
│   ├── src/main/resources/
│   └── target/
└── LAFFronted/              # 前端项目
    ├── src/
    ├── docs/
    └── dist/
```

## 🚀 联调前准备工作

### 1. 环境检查清单

#### 后端环境

- [x] Java 17+ 已安装
- [x] Maven 3.6+ 已安装
- [x] MySQL 8.0 已启动
- [x] 数据库连接正常
- [x] application.yml 配置正确

#### 前端环境

- [x] Node.js 16+ 已安装
- [x] npm/yarn 已安装
- [x] 依赖包已安装 (`npm install`)
- [x] 开发服务器可正常启动

#### 网络环境

- [x] 8080端口未被占用
- [x] 5173端口未被占用
- [x] 防火墙允许本地端口访问

### 2. 配置验证

#### 后端配置检查

```yaml
# application.yml 关键配置
server:
  port: 8080

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/swxz_db
    username: root
    password: root
```

#### 前端配置检查

```javascript
// src/api/index.js
const request = axios.create({
  baseURL: 'http://localhost:8080',
  timeout: 10000,
})
```

#### CORS配置验证

```java
// WebConfig.java
@Override
public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/**")
            .allowedOriginPatterns("*")
            .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
            .allowedHeaders("*")
            .allowCredentials(true)
            .maxAge(3600);
}
```

## 🔄 五阶段联调实施计划

### 阶段一：基础环境验证 (15分钟)

#### 1.1 启动后端服务

```bash
# 进入后端目录
cd C:\Users\34682\Desktop\new\swxz

# 启动Spring Boot应用
mvn spring-boot:run

# 或者运行已编译的jar包
java -jar target/swxz-1.0.0.jar
```

#### 1.2 验证后端服务状态

```bash
# 检查服务是否启动
curl http://localhost:8080/api/lost-items/all

# 或在浏览器访问
http://localhost:8080/swagger-ui/index.html
```

#### 1.3 启动前端服务

```bash
# 进入前端目录
cd C:\Users\34682\Desktop\new\LAFFronted

# 启动开发服务器
npm run dev
```

#### 1.4 验证前端服务状态

- 浏览器访问: http://localhost:5173
- 检查控制台是否有错误
- 验证页面是否正常加载

### 阶段二：API连通性测试 (30分钟)

#### 2.1 基础接口测试

**测试用例1: 获取失物列表**

```javascript
// 在浏览器控制台执行
fetch('http://localhost:8080/api/lost-items/all')
  .then(response => response.json())
  .then(data => console.log('失物列表:', data))
  .catch(error => console.error('错误:', error))
```

**预期结果:**

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "钱包",
      "type": 1,
      "color": 1,
      "description": "黑色钱包",
      "foundLocation": "图书馆",
      "building": "A栋",
      "specificLocation": "二楼阅览室",
      "status": 1,
      "publishTime": "2024-01-15T10:30:00",
      "adminId": 1
    }
  ]
}
```

#### 2.2 认证接口测试

**测试用例2: 用户登录**

```javascript
// 测试普通用户登录
fetch('http://localhost:8080/api/user/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    username: '2023001',
    password: '123456',
  }),
})
  .then(response => response.json())
  .then(data => {
    console.log('登录结果:', data)
    if (data.code === 200) {
      localStorage.setItem('token', data.data.token)
      localStorage.setItem('userInfo', JSON.stringify(data.data.user))
    }
  })
```

**测试用例3: 管理员登录**

```javascript
// 测试失物管理员登录
fetch('http://localhost:8080/api/admin/lost-item/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    username: 'admin001',
    password: 'admin123',
  }),
})
  .then(response => response.json())
  .then(data => console.log('管理员登录:', data))
```

#### 2.3 前端API调用测试

**在前端页面中测试:**

```javascript
// 在Vue组件中测试API调用
import { lostItemAPI } from '@/api/lostItem.js'

// 测试获取失物列表
const testGetLostItems = async () => {
  try {
    const result = await lostItemAPI.getAllLostItems()
    console.log('前端API调用成功:', result)
  } catch (error) {
    console.error('前端API调用失败:', error)
  }
}
```

### 阶段三：核心业务流程测试 (45分钟)

#### 3.1 完整用户流程测试

**流程1: 管理员发布失物**

1. 管理员登录
2. 进入发布页面
3. 填写失物信息
4. 上传失物图片
5. 提交发布
6. 验证发布成功

**测试步骤:**

```javascript
// 1. 管理员登录
const adminLogin = async () => {
  const loginData = {
    username: 'admin001',
    password: 'admin123',
  }

  try {
    const result = await adminAPI.lostItemAdminLogin(loginData)
    console.log('管理员登录成功:', result)
    return result.data.token
  } catch (error) {
    console.error('管理员登录失败:', error)
  }
}

// 2. 发布失物
const publishLostItem = async token => {
  const itemData = {
    name: '测试钱包',
    type: 1, // 钱包类型
    color: 2, // 黑色
    description: '黑色皮质钱包，内有身份证',
    foundLocation: '图书馆',
    building: 'A栋',
    specificLocation: '三楼自习室',
    adminId: 1,
  }

  try {
    const result = await lostItemAPI.publishLostItem(itemData)
    console.log('失物发布成功:', result)
    return result.data.id
  } catch (error) {
    console.error('失物发布失败:', error)
  }
}
```

**流程2: 用户搜索和领取**

1. 用户登录
2. 搜索失物
3. 查看失物详情
4. 申请领取
5. 验证申请成功

#### 3.2 搜索功能测试

**测试用例: 多条件搜索**

```javascript
const testSearch = async () => {
  const searchParams = {
    keyword: '钱包',
    type: 1,
    color: 2,
    building: 'A栋',
    startDate: '2024-01-01',
    endDate: '2024-12-31',
    page: 1,
    size: 10,
  }

  try {
    const result = await lostItemAPI.searchLostItems(searchParams)
    console.log('搜索结果:', result)
  } catch (error) {
    console.error('搜索失败:', error)
  }
}
```

#### 3.3 文件上传测试

**测试用例: 图片上传**

```javascript
const testFileUpload = async file => {
  const formData = new FormData()
  formData.append('file', file)

  try {
    const result = await request.post('/api/upload', formData, {
      headers: {
        'Content-Type': 'multipart/form-data',
      },
    })
    console.log('文件上传成功:', result)
    return result.data.url
  } catch (error) {
    console.error('文件上传失败:', error)
  }
}
```

### 阶段四：异常处理验证 (20分钟)

#### 4.1 网络异常测试

**测试场景1: 后端服务断开**

1. 停止后端服务
2. 在前端执行API调用
3. 验证错误处理机制
4. 检查用户提示是否友好

**测试场景2: 网络超时**

```javascript
// 模拟网络超时
const testTimeout = async () => {
  try {
    // 设置较短的超时时间
    const result = await axios.get('/api/lost-items/all', {
      timeout: 100, // 100ms超时
    })
  } catch (error) {
    console.log('超时处理:', error.message)
  }
}
```

#### 4.2 认证异常测试

**测试场景3: Token过期**

```javascript
// 使用过期或无效token
const testInvalidToken = async () => {
  // 设置无效token
  localStorage.setItem('token', 'invalid_token')

  try {
    const result = await userAPI.getUserProfile()
  } catch (error) {
    console.log('Token验证失败:', error)
    // 验证是否自动跳转到登录页
  }
}
```

#### 4.3 数据验证测试

**测试场景4: 表单验证**

```javascript
// 测试必填字段验证
const testFormValidation = async () => {
  const invalidData = {
    name: '', // 空名称
    type: null, // 空类型
    description: 'a'.repeat(1001), // 超长描述
  }

  try {
    await lostItemAPI.publishLostItem(invalidData)
  } catch (error) {
    console.log('表单验证错误:', error.message)
  }
}
```

### 阶段五：性能和用户体验优化 (30分钟)

#### 5.1 响应时间测试

**测试指标:**

- API响应时间 < 2秒
- 页面加载时间 < 3秒
- 图片上传时间 < 10秒

**测试方法:**

```javascript
const measureApiPerformance = async () => {
  const startTime = performance.now()

  try {
    await lostItemAPI.getAllLostItems()
    const endTime = performance.now()
    const responseTime = endTime - startTime

    console.log(`API响应时间: ${responseTime}ms`)

    if (responseTime > 2000) {
      console.warn('API响应时间过长，需要优化')
    }
  } catch (error) {
    console.error('性能测试失败:', error)
  }
}
```

#### 5.2 用户体验检查

**检查项目:**

- [ ] 加载状态显示
- [ ] 错误提示清晰
- [ ] 成功操作反馈
- [ ] 表单验证提示
- [ ] 响应式布局
- [ ] 无障碍访问

#### 5.3 内存泄漏检查

**检查方法:**

1. 打开浏览器开发者工具
2. 切换到Performance标签
3. 录制页面操作过程
4. 分析内存使用情况
5. 检查是否有内存泄漏

## 🔧 常见问题排查指南

### 问题1: CORS跨域错误

**错误现象:**

```
Access to fetch at 'http://localhost:8080/api/lost-items/all'
from origin 'http://localhost:5173' has been blocked by CORS policy
```

**解决方案:**

1. 检查后端CORS配置
2. 确认WebConfig.java中的配置正确
3. 重启后端服务

### 问题2: 404接口不存在

**错误现象:**

```
GET http://localhost:8080/api/lost-items/all 404 (Not Found)
```

**排查步骤:**

1. 检查后端Controller路径
2. 确认接口URL拼写正确
3. 查看后端启动日志
4. 访问Swagger文档确认接口

### 问题3: 数据库连接失败

**错误现象:**

```
com.mysql.cj.jdbc.exceptions.CommunicationsException:
Communications link failure
```

**解决方案:**

1. 检查MySQL服务是否启动
2. 验证数据库连接配置
3. 确认数据库用户权限
4. 检查防火墙设置

### 问题4: Token认证失败

**错误现象:**

```
401 Unauthorized
```

**排查步骤:**

1. 检查token是否正确存储
2. 验证请求头是否包含Authorization
3. 确认token格式正确
4. 检查token是否过期

### 问题5: 文件上传失败

**错误现象:**

```
413 Payload Too Large
或
500 Internal Server Error
```

**解决方案:**

1. 检查文件大小限制
2. 确认上传目录权限
3. 验证文件类型限制
4. 检查磁盘空间

## 📊 测试验收标准

### 功能完整性验收

#### 用户功能

- [ ] 用户注册/登录
- [ ] 浏览失物列表
- [ ] 搜索失物
- [ ] 查看失物详情
- [ ] 申请领取失物
- [ ] 查看个人信息
- [ ] 修改个人信息

#### 管理员功能

- [ ] 管理员登录
- [ ] 发布失物信息
- [ ] 管理发布的失物
- [ ] 处理领取申请
- [ ] 查看统计信息

#### 系统功能

- [ ] 文件上传
- [ ] 数据分页
- [ ] 搜索筛选
- [ ] 状态管理
- [ ] 错误处理

### 性能指标验收

| 指标         | 标准    | 实际值 | 状态 |
| ------------ | ------- | ------ | ---- |
| API响应时间  | < 2秒   | \_\_\_ | ⏳   |
| 页面加载时间 | < 3秒   | \_\_\_ | ⏳   |
| 文件上传时间 | < 10秒  | \_\_\_ | ⏳   |
| 内存使用     | < 100MB | \_\_\_ | ⏳   |
| CPU使用率    | < 50%   | \_\_\_ | ⏳   |

### 用户体验验收

- [ ] 界面响应及时
- [ ] 操作流程顺畅
- [ ] 错误提示清晰
- [ ] 加载状态明确
- [ ] 移动端适配良好

## 🎯 联调完成后的后续工作

### 1. 代码优化

- 性能优化
- 代码重构
- 安全加固
- 错误处理完善

### 2. 测试完善

- 单元测试
- 集成测试
- 端到端测试
- 压力测试

### 3. 部署准备

- 环境配置
- 数据库迁移
- 静态资源处理
- 监控配置

### 4. 文档完善

- API文档更新
- 用户手册
- 运维文档
- 故障排除手册

## 📝 联调记录模板

### 测试记录表

| 测试项目  | 测试时间 | 测试结果 | 问题描述 | 解决方案 | 负责人 |
| --------- | -------- | -------- | -------- | -------- | ------ |
| 环境验证  |          |          |          |          |        |
| API连通性 |          |          |          |          |        |
| 用户登录  |          |          |          |          |        |
| 失物发布  |          |          |          |          |        |
| 失物搜索  |          |          |          |          |        |
| 文件上传  |          |          |          |          |        |
| 异常处理  |          |          |          |          |        |
| 性能测试  |          |          |          |          |        |

### 问题跟踪表

| 问题ID  | 发现时间 | 问题描述 | 严重程度 | 状态          | 解决时间 | 备注 |
| ------- | -------- | -------- | -------- | ------------- | -------- | ---- |
| BUG-001 |          |          | 高/中/低 | 待解决/已解决 |          |      |
| BUG-002 |          |          | 高/中/低 | 待解决/已解决 |          |      |

## 🚀 快速启动命令

### 后端启动

```bash
# 方式1: Maven启动
cd C:\Users\34682\Desktop\new\swxz
mvn clean spring-boot:run

# 方式2: JAR包启动
cd C:\Users\34682\Desktop\new\swxz
mvn clean package
java -jar target/swxz-1.0.0.jar
```

### 前端启动

```bash
# 开发模式启动
cd C:\Users\34682\Desktop\new\LAFFronted
npm install
npm run dev

# 生产构建
npm run build
npm run preview
```

### 数据库启动

```bash
# Docker方式启动MySQL
docker-compose up -d mysql

# 或手动启动MySQL服务
net start mysql80
```

---

**文档版本**: v1.0  
**创建时间**: 2024年1月  
**更新时间**: 2024年1月  
**维护人员**: 开发团队

> 💡 **提示**: 本文档应随着项目进展持续更新，确保联调方案的时效性和准确性。
